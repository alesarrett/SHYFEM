



The pre-processing routine |vp| is used to generate an
optimized version of the file that describes the basin
where the main program is to be run. In the following a
short introduction in using this program is given.

\subsection{The pre-processing routine {\tt vp}}

The main routine |hp| reads the basin file generated by
the pre-processing routine |vp| and uses it as the description
of the domain where the hydrodynamic equations have to be
solved.

The program |vp| is started by typing |vp| on the command line.
From this point on the program is interactive, asking you about
the basin file name and other options. Please follow the online
instructions.

The routine |vp| reads a file of type GRD. This type of file
can be generated and manipulated by the program |grid| which
is not described here. In short, the file GRD consists of
nodes and elements that describe the geometrical layout
of the basin. Moreover, the elements have a type and a depth.

The depth is needed by the main program |hp| to run the model.
The type of the element is used by |hp| to determine
the friction parameter on the bottom, since this parameter
may be assigned differently, depending on the various situations
of the bottom roughness.

This file GRD is read by |vp| and transformed into an
unformatted file BAS. It is this file that is then read
by the main routine |hp|. Therefore, if the name of the
basin is |lagoon|, then the file GRD is called |lagoon.grd|
and the output of the pre-processing routine |vp| is
called |lagoon.bas|.

The program |vp| normally uses the depths assigned to the
elements in the file GRD to determine the depth of the
finite elements to use in the program |hp|. In the case
that these depth values are not complete, and that all nodes
have depths assigned in the GRD file, the nodal values of the
depths are used and interpolated onto the elements. However,
if also these nodal depth values are incomplete or are missing
altogether, the program terminates with an error.

\subsection{Optimization of the bandwidth}

The main task of routine |vp| is the optimization of the 
internal numbering of the nodes and elements.
Re-numbering the elements is just a mere convenience. When
assembling the system matrix the contribution of
one element after the other has to be added to the system matrix.
If the elements are numbered in terms of lowest node numbers,
then the access of the nodal pointers is more regular in 
computer memory and paging is more likely to be inhibited.

However, re-numbering the nodes is absolutely necessary.
The system matrix to be solved is of band-matrix type.
I.e., non-zero entries are all concentrated along the
main diagonal in a more or less narrow band. The larger this
band is, the larger the amount of cpu time spent to
solve the system. The time to solve a band matrix
is of order $n \cdot m^2$, where $n$ is the size of the
matrix and $m$ is the bandwidth. Note that $m$ is normally
much smaller than $n$.

If the nodes are left with the original numbering, it is very likely
that the bandwidth is very high, unless the nodes in the
file GRD are by chance already optimized. Since the bandwidth $m$
is entering the above formula quadratically, the amount
of time spent solving the matrix will be prohibitive.
E.g., halving the bandwidth will speed up computations by
a factor of 4.

The bandwidth is equal to the maximum difference of node numbers
in one element. It is therefore important to re-number the
nodes in order to minimize this number. However, there exist
only heuristic algorithms for the minimization of this number.

The two main algorithms used in the routine |vp| are
the Cuthill McGee algorithm and the algorithm of Rosen. The first
one, starting from one node, tries to number all neighbors in
a greedy way, optimizing only this step. From the points
numbered in this step, the next neighbors are numbered.

This procedure is tried from more than one node, possibly
from all boundary nodes. The numbering resulting from this
algorithm is normally very good and needs only slight
enhancements to be optimum.

Once all nodes are numbered, the Rosen algorithm tries to
exchange these node numbers, where the highest difference
can be found. This normally gives only a slight improvement
of the bandwidth. It has been seen, however, that, if the
node numbers coming out from the Cuthill McGee algorithm
are reversed, before feeding them into the Rosen algorithm, 
the results tend to be slightly better. This step is also
performed by the program.

All these steps are performed by the program without
intervention by the operator, if the automatic optimization
of bandwidth is chosen in the program |vp|. The choices
are to not perform the bandwidth optimization at all
(GRD file has already optimized node numbering), perform
it automatically or perform it manually. It is suggested
to always perform automatic optimization of the bandwidth.
This choice will lead to a nearly optimum numbering of the
nodes and will be by all means good results.

If, however, you decide to do a manual optimization, please
follow the online instructions in the program.

\subsection{Internal and external node numbering}

As explained above, the elements and nodes of the basin are re-numbered 
in order to optimize the bandwidth of the system matrix and so
the execution speed of the program. 

However, this re-numbering of the node and elements is transparent
to the user. The program keeps pointers from the original numbering
(external numbers) to the optimized numbering (internal numbers).
The user has to deal only with external numbers, even if the 
program uses internally the other number system.

Moreover, the internal numbers are generated consecutively.
Therefore, if there are a total of 4000 nodes in the system, the internal
nodes run from 1 to 4000. The external node numbers,
on the other side, can be anything the user likes. They just must be
unique. This allows for insertion and deletion of nodes without
having to re-number over and over again the basin.

The nodes that have to be specified in the input parameter file
use again external numbers. In this way, changing the structure of
the basin does not at all change the node and element numbers in the
input parameter file. Except in the case, where modifications
actually touch nodes and elements that are specified in the 
parameter file.

