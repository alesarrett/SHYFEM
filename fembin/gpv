#!/bin/sh
#
# shell for gnuplot
#
# 1.23	accepts -u all
# 1.22	remove parts of legend (option -l)
# 1.21	better conti line treatment, signal error in option
# 1.20	specify x/y range
# 1.10	using different columns
# 1.00	original version

######################################################### defaults

title="Vertical Section"
type="monochrome"
orientation="landscape"
using="using 1:2"
nolegend="xyz*^+="	#something very unlikely

######################################################### programs

psgnu="psgnu"
gnuplot="gnuplot"
extractcol="extractcol"

######################################################### copyright

copy1="File automatically generated by gpv"
copy2="gpv - shell for gnuplot                Version 1.23"
copy3="Copyright (c) 1998-1999 Georg Umgiesser - ISDGM/CNR"
copy4="e-mail: georg@isdgm.ve.cnr.it"

######################################################### help - usage

Copy()
{
  echo "$copy2"
  echo "$copy3"
}

Usage()
{
  echo "Usage: gpv [ -h | -help ] [ -options ] file[s]"
}

FullUsage()
{
  echo ""

  Copy
  echo ""
  Usage

  echo ""
  echo "Available options:"
  echo "  -h|-help         this help"
  echo "  -c               color output"
  echo "  -p               portrait mode"
  echo "  -t  title        give title of plot"
  echo "  -tx ylabel       give x-label of plot"
  echo "  -ty ylabel       give y-label of plot"
  echo "  -rx xmin:xmax    give x-range of plot"
  echo "  -ry ymin:ymax    give y-range of plot"
  echo "  -l  string       string that is removed from legend if found"
}

ErrorOption()
{
  echo "No such option : $1"
}

MakeLegend()	#substitutes _ with blank and removes string in $nolegend
{
  echo $1 | sed -e "s/$nolegend//g" | sed -e 's/_/ /g'
}

Plotting()
{
  echo "splot \"$1\"" >> gnu.tmp

  echo "" >> gnu.tmp
  echo "quit" >>  gnu.tmp
}

######################################################### read options

while [ -n "$1" ]
do
   case $1 in
	-c)		type="color";;
	-p)		orientation="portrait";;
	-t)		title=$2; shift;;
	-tx)		xlabel=$2; shift;;
	-ty)		ylabel=$2; shift;;
	-rx)		xrange=$2; shift;;
	-ry)		yrange=$2; shift;;
	-l)		nolegend=$2; shift;;
	-h|-help)	FullUsage; exit 0;;
	-*)		ErrorOption $1; exit 1;;
	*)		break;;
   esac
   shift
done

######################################################### no file -> write help

if [ $# -le 0 ]; then
  Usage
  exit 1;
fi

######################################################### write header

cat > gnu.tmp <<EOI

# $copy1
# $copy2
# $copy3
# $copy4

set terminal postscript $orientation $type
set output "out.ps"

set data style lines
set contour
set nogrid
set nosurface
set view 0,0,1
set title "$title"

EOI

######################################################### write defaults

if [ -n "$xlabel" ]; then
  echo "set xlabel \"$xlabel\"" >> gnu.tmp
fi
if [ -n "$ylabel" ]; then
  echo "set ylabel \"$ylabel\"" >> gnu.tmp
fi

if [ -n "$xrange" ]; then
  echo "set xrange [$xrange]" >> gnu.tmp
fi
if [ -n "$yrange" ]; then
  echo "set yrange [$yrange]" >> gnu.tmp
fi

if [ $orientation = "portrait" ]; then
  echo "set size 0.7,0.7" >> gnu.tmp
fi

echo "" >> gnu.tmp

######################################################### files to plot

files="$*"

######################################################### start plotting

Plotting $files

######################################################### call gnuplot

$gnuplot gnu.tmp

######################################################### adjust landscape mode

if [ $orientation = "landscape" ]; then
  $psgnu out.ps
fi

######################################################### end

